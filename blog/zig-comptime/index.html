<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com https://www.youtube.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://storopoli.com name=base><title>
Jose Storopoli, PhD • Zig comptime is such a powerful built-in feature</title><link href=https://storopoli.com/favicon.svg rel=icon type=image/png><link title="Jose Storopoli, PhD - Atom Feed" href=https://storopoli.com/atom.xml rel=alternate type=application/atom+xml><link href="https://storopoli.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://storopoli.com/main.css?h=6b1dda977391dad0c76e" rel=stylesheet><link href="https://storopoli.com/extra.css?h=33c2dfb527f758787862" rel=stylesheet><link href="https://storopoli.com/skins/teal.css?h=bd19e558a52d678a50de" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="Personal website of Jose Storopoli, PhD" name=description><meta content="Personal website of Jose Storopoli, PhD" property=og:description><meta content="Zig comptime is such a powerful built-in feature" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://storopoli.com/blog/zig-comptime/ property=og:url><meta content="Jose Storopoli, PhD" property=og:site_name><noscript><link href=https://storopoli.com/no_js.css rel=stylesheet></noscript><script src=https://storopoli.com/js/initializeTheme.min.js></script><script defer src=https://storopoli.com/js/themeSwitcher.min.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://storopoli.com>Jose Storopoli, PhD</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://storopoli.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://storopoli.com/tags/>tags </a><li class=menu-icons-container><ul class=menu-icons-group><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Zig comptime is such a powerful built-in feature</h1><ul class=meta><span class="hidden p-author h-card"> <a title="Jose Storopoli, PhD" class=u-url href=https://storopoli.com rel=author>Jose Storopoli, PhD</a> </span><li>3rd Nov 2024<li title="1114 words"><span aria-hidden=true class=separator>•</span>6 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://storopoli.com/tags/zig/>zig</a>, <li class=tag><a href=https://storopoli.com/tags/compiler/>compiler</a>, <li class=tag><a href=https://storopoli.com/tags/rust/>rust</a></ul><div class=toc-container><h3>Table of Contents</h3><ul><li><a href=https://storopoli.com/blog/zig-comptime/#zig-s-comptime>Zig’s comptime</a> <ul><li><a href=https://storopoli.com/blog/zig-comptime/#parameters-of-functions>Parameters of functions</a><li><a href=https://storopoli.com/blog/zig-comptime/#variables>Variables</a><li><a href=https://storopoli.com/blog/zig-comptime/#expressions>Expressions</a><li><a href=https://storopoli.com/blog/zig-comptime/#bonus-example-zig-s-generics>Bonus example: Zig’s Generics</a><li><a href=https://storopoli.com/blog/zig-comptime/#the-caveats-of-comptime>The caveats of comptime</a></ul><li><a href=https://storopoli.com/blog/zig-comptime/#the-motivating-example>The motivating example</a> <ul><li><a href=https://storopoli.com/blog/zig-comptime/#zero-padding-check-in-zig>Zero padding check in Zig</a><li><a href=https://storopoli.com/blog/zig-comptime/#zero-padding-check-in-rust>Zero padding check in Rust</a></ul><li><a href=https://storopoli.com/blog/zig-comptime/#conclusion>Conclusion</a></ul></div><section class=body><p>I have been following the development of <a href=https://ziglang.org/>Zig</a> for a while now. I like the idea of a systems programming language that is <strong>simple to learn and use, <em>yet</em> powerful and expressive</strong>.<p>With Rust, I can get the powerful and expressive part, <em>but</em> the <strong>learning curve is a bit steep</strong>, and some parts of the language are <strong>complex and hard to understand</strong>. For example <code>async</code>/<code>await</code> (specially if you have to deal with <code>Stream</code>s and <code>Pin</code>s); and the macro domain-specific language (DSL).<p>Now back to Zig. The language can be learned in one lazy morning. That’s exactly what I did and then played around <a href=https://github.com/storopoli/graphs-complexity/pull/21>migrating some C code to Zig from an old course</a> that I used to teach about algorithmic complexity. The code is now simpler and more readable than the original C code. I have hugely benefited from Zig’s built-in features such as:<ul><li><a href=https://ziglang.org/documentation/master/#Optionals><strong>Optionals</strong></a><li><a href=https://ziglang.org/documentation/master/#Errors><strong>Error handling</strong></a><li><a href=https://ziglang.org/documentation/master/#comptime><strong><code>comptime</code></strong> (more on that, since it is the main topic of this post)</a><li><a href=https://ziglang.org/documentation/master/#Operators><strong>safe integer/floating-point arithmetic</strong></a><li><a href=https://ziglang.org/documentation/master/#defer><strong>deferring memory deallocation</strong> to the end of the scope</a><li><a href=https://ziglang.org/documentation/master/#struct><strong><code>struct</code>s with functions</strong> (methods)</a><li><a href=https://ziglang.org/documentation/master/#Choosing-an-Allocator><strong>BYOA</strong> (Bring Your Own Allocator)</a><sup class=footnote-reference id=fr-BYOA-1><a href=#fn-BYOA>1</a></sup></ul><p>Writing in Zig, comparing to C, is such a joy and you are always sure that you won’t spend hours debugging because Zig has:<ul><li><strong>No hidden control flow</strong><li><strong>No hidden memory allocations</strong><li><strong>No preprocessor, no macros</strong></ul><p>I highly recommend you to give Zig a try. It is the <strong>ultimate C killer</strong>. In fact, you can <strong>compile and interop C and Zig</strong> code with Zig. So you can start migrating your C codebase to Zig incrementally. As an additional caveat, <strong>Zig can be faster than C</strong>.<h2 id=zig-s-comptime>Zig’s <code>comptime</code></h2><p>I’ve been wanting to write about Zig for a while now. But I had no topic in mind. Then, I was inspired by this talk by <a href=https://matklad.github.io>@matklad</a> on modern systems programming comparing Rust and Zig interwoven with his professional journey from Rust to Zig, and the amazing work he’s doing at <a href=https://tigerbeetle.com>TigerBeetle</a>:</p><style>.embed-container{max-width:100%;height:0;padding-bottom:56.25%;position:relative;overflow:hidden}.embed-container iframe,.embed-container object,.embed-container embed{width:100%;height:100%;position:absolute;top:0;left:0}</style><div class=embed-container><iframe src="https://www.youtube.com/embed/4aLy6qjhHeo?t=1904" allowfullscreen frameborder=0></iframe></div><p>The talk goes on to compare Rust and Zig in terms of systems programming. Then, at the middle of the talk, he starts to talk about Zig. One of the Zig’s features that he covers is Zig’s <code>comptime</code> feature which allows to <strong>run code and evaluate expressions at compile-time</strong> <em>without</em> the need for meta-programming/macros or code generation.<p>Let me explain now what is <code>comptime</code> in Zig. You can do <code>comptime</code> in Zig in different places, such as:<ol><li><strong>Parameters of functions</strong><li><strong>Variables</strong><li><strong>Expressions</strong></ol><p>Here are some examples thanks to <a href=https://kristoff.it/blog/what-is-zig-comptime/>Loris Cro</a> and <a href=https://ziglang.org/documentation/master/#comptime>Zig’s documentation</a>.<h3 id=parameters-of-functions>Parameters of functions</h3><p>The first Zig code example is about using <code>comptime</code> to decide the length of a statically-allocated array:<pre class="language-zig z-code" data-lang=zig><code class=language-zig data-lang=zig><span class="z-source z-zig"><span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">multiply</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-variable z-parameter z-zig">a</span><span class="z-punctuation z-separator z-zig">:</span> <span class="z-storage z-type z-zig">i64</span><span class="z-punctuation z-separator z-zig">,</span> <span class="z-variable z-parameter z-zig">b</span><span class="z-punctuation z-separator z-zig">:</span> <span class="z-storage z-type z-zig">i64</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">i64</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-zig">return</span> a <span class="z-keyword z-operator z-arithmetic z-zig">*</span> b<span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">pub</span> <span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">main</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">void</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-storage z-modifier z-zig">const</span> len <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-storage z-modifier z-zig">comptime</span> <span class="z-variable z-function z-zig">multiply</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-constant z-numeric z-integer z-zig">4</span><span class="z-punctuation z-separator z-zig">,</span> <span class="z-constant z-numeric z-integer z-zig">5</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">    <span class="z-storage z-modifier z-zig">const</span> <span class="z-variable z-other z-member z-zig">my_static_array</span><span class="z-punctuation z-separator z-zig">:</span> [len]<span class="z-storage z-type z-zig">u8</span> <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-constant z-language z-zig">undefined</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span></code></pre><h3 id=variables>Variables</h3><p>The second example is about using <code>comptime</code> to define a variable. This Zig code evaluates a Fibonacci number at compile-time:<pre class="language-zig z-code" data-lang=zig><code class=language-zig data-lang=zig><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">const</span> expect <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-keyword z-control z-import z-zig">@import</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-string z-quoted z-double z-zig">"std"</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span>.testing.expect<span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">fibonacci</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-variable z-parameter z-zig">index</span><span class="z-punctuation z-separator z-zig">:</span> <span class="z-storage z-type z-zig">u32</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">u32</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-conditional z-zig">if</span> <span class="z-punctuation z-section z-parens z-begin z-zig">(</span>index <span class="z-keyword z-operator z-logical z-zig"><</span> <span class="z-constant z-numeric z-integer z-zig">2</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-control z-zig">return</span> index<span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-zig">return</span> <span class="z-variable z-function z-zig">fibonacci</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>index <span class="z-keyword z-operator z-arithmetic z-zig">-</span> <span class="z-constant z-numeric z-integer z-zig">1</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-arithmetic z-zig">+</span> <span class="z-variable z-function z-zig">fibonacci</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>index <span class="z-keyword z-operator z-arithmetic z-zig">-</span> <span class="z-constant z-numeric z-integer z-zig">2</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-storage z-type z-test z-zig">test</span> <span class="z-string z-quoted z-double z-zig">"fibonacci"</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-comment z-line z-zig">// test fibonacci at run-time
</span></span><span class="z-source z-zig">    <span class="z-keyword z-control z-conditional z-zig">try</span> <span class="z-variable z-function z-zig">expect</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-variable z-function z-zig">fibonacci</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-constant z-numeric z-integer z-zig">7</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-logical z-zig">==</span> <span class="z-constant z-numeric z-integer z-zig">13</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig">    <span class="z-comment z-line z-zig">// test fibonacci at compile-time
</span></span><span class="z-source z-zig">    <span class="z-keyword z-control z-conditional z-zig">try</span> <span class="z-storage z-modifier z-zig">comptime</span> <span class="z-variable z-function z-zig">expect</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-variable z-function z-zig">fibonacci</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-constant z-numeric z-integer z-zig">7</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-logical z-zig">==</span> <span class="z-constant z-numeric z-integer z-zig">13</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span></code></pre><h3 id=expressions>Expressions</h3><p>The final example is about using <code>comptime</code> to evaluate an expression. The following Zig code evaluates a <code>for</code>-loop at compile-time.<pre class="language-zig z-code" data-lang=zig><code class=language-zig data-lang=zig><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">const</span> max <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-constant z-numeric z-integer z-zig">10</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">comptime</span> <span class="z-storage z-modifier z-zig">var</span> total <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-constant z-numeric z-integer z-zig">0</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">comptime</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-zig">for</span> <span class="z-punctuation z-section z-parens z-begin z-zig">(</span>1<span class="z-keyword z-operator z-other z-zig">..</span>max<span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-bitwise z-zig">|</span>i<span class="z-keyword z-operator z-bitwise z-zig">|</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        total <span class="z-keyword z-operator z-assignment z-zig">+=</span> i<span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span></code></pre><h3 id=bonus-example-zig-s-generics>Bonus example: Zig’s Generics</h3><p>Now you can see how impressive <code>comptime</code> is. In fact, Zig’s generics are implemented using <code>comptime</code>. Check the Zig code below that creates a generic <code>List</code> data structure:<pre class="language-zig z-code" data-lang=zig><code class=language-zig data-lang=zig><span class="z-source z-zig"><span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">List</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-storage z-type z-zig">comptime</span> <span class="z-variable z-parameter z-zig">T</span><span class="z-punctuation z-separator z-zig">:</span> <span class="z-storage z-type z-zig">type</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">type</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-zig">return</span> <span class="z-storage z-type z-struct z-zig">struct</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        <span class="z-variable z-other z-member z-zig">items</span><span class="z-punctuation z-separator z-zig">:</span> []<span class="z-storage z-type z-zig">T</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-variable z-other z-member z-zig">len</span><span class="z-punctuation z-separator z-zig">:</span> <span class="z-storage z-type z-zig">usize</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-comment z-line z-zig">// The generic List data structure can be instantiated by passing in a type:
</span></span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">var</span> <span class="z-variable z-other z-member z-zig">buffer</span><span class="z-punctuation z-separator z-zig">:</span> [<span class="z-constant z-numeric z-integer z-zig">10</span>]<span class="z-storage z-type z-zig">i32</span> <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-constant z-language z-zig">undefined</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">var</span> list <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-variable z-function z-zig">List</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>i32<span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    .items <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-keyword z-operator z-bitwise z-zig">&</span>buffer<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">    .len <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-constant z-numeric z-integer z-zig">0</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-terminator z-zig">;</span>
</span></code></pre><h3 id=the-caveats-of-comptime>The caveats of <code>comptime</code></h3><p><code>comptime</code> has some caveats. <code>comptime</code> expressions must be known at compile-time. That means:<ol><li>At the callsite, the value must be known at compile-time, or it is a compile error.<li>In the function definition, the value is known at compile-time.</ol><p>If you guarantee that the value is known at compile-time, you can use <code>comptime</code> to evaluate anything at compile-time.<h2 id=the-motivating-example>The motivating example</h2><p>The motivating example for this blog post is an explanation that matklad gives in his talk about how they use <code>comptime</code> at TigerBeetle to make sure that a <code>struct</code> that represents a header has no padding in its fields.<p><img alt="TigerBeetle’s header struct" src=https://storopoli.com/blog/zig-comptime/header_padding.png><p>Then, he said that to have the same checks at compile-time in Rust, you would need to bring a lot of complexity with <code>proc-macro</code>s. That made me curious about how hard it would be to do the same in Rust.<p>So here’s a toy problem that I came up with to compare Zig and Rust. Instead of checking for padding in fields of a <code>struct</code>, I decided to simplify and check for zero-padding in a string.<h3 id=zero-padding-check-in-zig>Zero padding check in Zig</h3><p>In Zig, strings are arrays of bytes, and you can iterate over them at compile-time:<pre class="language-zig z-code" data-lang=zig><code class=language-zig data-lang=zig><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">const</span> std <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-keyword z-control z-import z-zig">@import</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-string z-quoted z-double z-zig">"std"</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">checkZeroPadding</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-storage z-type z-zig">comptime</span> <span class="z-variable z-parameter z-zig">s</span><span class="z-punctuation z-separator z-zig">:</span> []<span class="z-storage z-modifier z-zig">const</span> <span class="z-storage z-type z-zig">u8</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">void</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-keyword z-control z-zig">for</span> <span class="z-punctuation z-section z-parens z-begin z-zig">(</span>s<span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-bitwise z-zig">|</span>c<span class="z-keyword z-operator z-bitwise z-zig">|</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        <span class="z-keyword z-control z-conditional z-zig">if</span> <span class="z-punctuation z-section z-parens z-begin z-zig">(</span>c <span class="z-keyword z-operator z-logical z-zig">==</span> <span class="z-string z-quoted z-single z-zig">'0'</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">            <span class="z-support z-function z-zig">@compileError</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-string z-quoted z-double z-zig">"String contains zero-padding"</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">        <span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-storage z-modifier z-zig">pub</span> <span class="z-storage z-type z-function z-zig">fn</span> <span class="z-entity z-name z-function">main</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span><span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-storage z-type z-zig">void</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-storage z-modifier z-zig">comptime</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        <span class="z-storage z-modifier z-zig">const</span> str1 <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-string z-quoted z-double z-zig">"12345"</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">        <span class="z-storage z-modifier z-zig">const</span> str2 <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-string z-quoted z-double z-zig">"01234"</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig">        <span class="z-variable z-function z-zig">checkZeroPadding</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>str1<span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span> <span class="z-comment z-line z-zig">// This will compile
</span></span><span class="z-source z-zig">        <span class="z-variable z-function z-zig">checkZeroPadding</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>str2<span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span> <span class="z-comment z-line z-zig">// This will cause a compile-time error
</span></span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span></code></pre><p>The code above uses <code>comptime</code> to check if a string has zero-padding.<h3 id=zero-padding-check-in-rust>Zero padding check in Rust</h3><p>Compare this to how to do the same thing in Rust. We need to use a procedural macro to achieve the same result. Note that <a href=https://doc.rust-lang.org/reference/macros.html>macros in Rust</a> have their own domain-specific language (DSL) that is not Rust itself. Hence, you need to learn a new language to write a macro in Rust.<p>First create a library crate named <code>zero-padding-checker</code> that exports a <a href=https://doc.rust-lang.org/reference/procedural-macros.html><code>proc-macro</code></a> and add a procedural macro to check for zero-padding in a string:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">proc_macro<span class="z-punctuation z-accessor z-rust">::</span></span>TokenStream<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">quote<span class="z-punctuation z-accessor z-rust">::</span></span>quote<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">syn<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>parse_macro_input<span class="z-punctuation z-separator z-rust">,</span> LitStr</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">proc_macro</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">check_zero_padding</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">input</span><span class="z-punctuation z-separator z-rust">:</span> TokenStream</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> TokenStream</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> input <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-macro z-rust">parse_macro_input!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>input <span class="z-keyword z-operator z-rust">as</span> LitStr</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> value <span class="z-keyword z-operator z-assignment z-rust">=</span> input<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">value</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">if</span> value<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">starts_with</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-single z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">'</span>0<span class="z-punctuation z-definition z-string z-end z-rust">'</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">return</span> <span class="z-support z-macro z-rust">quote!</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-support z-macro z-rust">compile_error!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>String contains zero-padding<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">quote!</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-rust">#</span>input
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>Then you call the macro in your code:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">zero_padding_checker<span class="z-punctuation z-accessor z-rust">::</span></span>check_zero_padding<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">check_zero_padding!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>12345<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This will compile
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">check_zero_padding!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>01234<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This will cause a compile-time error
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>The Rust code above is far more complex than the Zig code. First, it requires dependency on <code>syn</code> and <code>quote</code> crates (note that the <code>proc-macro</code> crate is provided by Rust’s compiler). Second, despite the fact that this is a simple example, procedural macros in Rust have their own domain-specific language (DSL) and the complexity can grow quickly as the problem becomes more complex.<h2 id=conclusion>Conclusion</h2><p>Yeah, <strong>Zig is a great language and has a bright future ahead</strong>. <strong><code>comptime</code></strong> is a powerful feature that allows you to <strong>run almost <em>any</em> code at compile-time</strong>. It is built into the language and you don’t need to learn a new language to use it or bring external dependencies to make it work.<p>If you like to <strong>learn more about Zig</strong>, I recommend reading the <a href=https://ziglang.org/learn/>learn section of Zig’s documentation</a>. Also, to learn more about <strong>Zig’s <code>comptime</code></strong> feature, check <a href=https://ziglang.org/documentation/master/#comptime>Zig’s documentation on <code>comptime</code></a>.<footer class=footnotes><ol class=footnotes-list><li id=fn-BYOA><p>Zig doesn’t have a built-in allocator. And I don’t know it the acronym BYOA is a thing. I just made it up. But it makes sense, right? <a href=#fr-BYOA-1>↩</a></p></ol></footer></section></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=overlay for=toc-toggle></label><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://storopoli.com/blog/zig-comptime/#zig-s-comptime>Zig’s comptime</a> <ul><li><a href=https://storopoli.com/blog/zig-comptime/#parameters-of-functions>Parameters of functions</a><li><a href=https://storopoli.com/blog/zig-comptime/#variables>Variables</a><li><a href=https://storopoli.com/blog/zig-comptime/#expressions>Expressions</a><li><a href=https://storopoli.com/blog/zig-comptime/#bonus-example-zig-s-generics>Bonus example: Zig’s Generics</a><li><a href=https://storopoli.com/blog/zig-comptime/#the-caveats-of-comptime>The caveats of comptime</a></ul><li><a href=https://storopoli.com/blog/zig-comptime/#the-motivating-example>The motivating example</a> <ul><li><a href=https://storopoli.com/blog/zig-comptime/#zero-padding-check-in-zig>Zero padding check in Zig</a><li><a href=https://storopoli.com/blog/zig-comptime/#zero-padding-check-in-rust>Zero padding check in Rust</a></ul><li><a href=https://storopoli.com/blog/zig-comptime/#conclusion>Conclusion</a></ul></div></div></div><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://storopoli.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://storopoli.com/atom.xml> <img alt=feed loading=lazy src=https://storopoli.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:jose@storopoli.com> <img alt=email loading=lazy src=https://storopoli.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://storopoli.com/publickey.txt> <img alt=pgp loading=lazy src=https://storopoli.com/social_icons/key.svg title=pgp> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/storopoli/> <img alt=github loading=lazy src=https://storopoli.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://matrix.to/#/@jose:storopoli.com> <img alt=matrix loading=lazy src=https://storopoli.com/social_icons/matrix.svg title=matrix> </a><li><a class="nav-links no-hover-padding social" href="https://simplex.chat/contact#/?v=2-5&smp=smp%3A%2F%2FUkMFNAXLXeAAe0beCa4w6X_zp18PwxSaSjY17BKUGXQ%3D%40smp12.simplex.im%2FUXrwU_eqdgeHQ6HYehFs0s8VRHOr3k47%23%2F%3Fv%3D1-2%26dh%3DMCowBQYDK2VuAyEApVAYxmE0bpIIiPftNjehy4qOoa14ubyEGzbRX_BlO0w%253D%26srv%3Die42b5weq7zdkghocs3mgxdjeuycheeqqmksntj57rmejagmg4eor5yd.onion" rel=" me"> <img alt=simplex loading=lazy src=https://storopoli.com/social_icons/simplex.svg title=simplex> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://orcid.org/0000-0002-0559-5176> <img alt=orcid loading=lazy src=https://storopoli.com/social_icons/orcid.svg title=orcid> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> • <a href=https://github.com/storopoli/storopoli.com> Site source </a></small></div></section></footer>