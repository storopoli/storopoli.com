<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com https://www.youtube.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://storopoli.com name=base><title>
Jose Storopoli, PhD • Shamir's secret sharing</title><link href=https://storopoli.com/favicon.svg rel=icon type=image/png><link title="Jose Storopoli, PhD - Atom Feed" href=https://storopoli.com/atom.xml rel=alternate type=application/atom+xml><link href="https://storopoli.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://storopoli.com/main.css?h=6b1dda977391dad0c76e" rel=stylesheet><link href="https://storopoli.com/extra.css?h=33c2dfb527f758787862" rel=stylesheet><link href="https://storopoli.com/skins/teal.css?h=bd19e558a52d678a50de" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="Personal website of Jose Storopoli, PhD" name=description><meta content="Personal website of Jose Storopoli, PhD" property=og:description><meta content="Shamir's secret sharing" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://storopoli.com/blog/shamir-secret-sharing/ property=og:url><meta content="Jose Storopoli, PhD" property=og:site_name><noscript><link href=https://storopoli.com/no_js.css rel=stylesheet></noscript><script src=https://storopoli.com/js/initializeTheme.min.js></script><script defer src=https://storopoli.com/js/themeSwitcher.min.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://storopoli.com>Jose Storopoli, PhD</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://storopoli.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://storopoli.com/tags/>tags </a><li class=menu-icons-container><ul class=menu-icons-group><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Shamir’s secret sharing</h1><ul class=meta><span class="hidden p-author h-card"> <a title="Jose Storopoli, PhD" class=u-url href=https://storopoli.com rel=author>Jose Storopoli, PhD</a> </span><li>14th Apr 2024<li title="1099 words"><span aria-hidden=true class=separator>•</span>6 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://storopoli.com/tags/cryptography/>cryptography</a>, <li class=tag><a href=https://storopoli.com/tags/bitcoin/>bitcoin</a></ul><div class=toc-container><h3>Table of Contents</h3><ul><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#polynomial-interpolation>Polynomial Interpolation</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#shamir-s-secret-sharing>Shamir’s Secret Sharing</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#rotating-shares>Rotating Shares</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#the-polynomial-king>The Polynomial King</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#conclusion>Conclusion</a></ul></div><section class=body><noscript><div class="admonition warning"><div class="admonition-icon admonition-icon-warning"></div><div class=admonition-content><strong class=admonition-title> Evil JavaScript </strong><p>This post uses <a href=https://katex.org/>KaTeX</a> to render mathematical expressions.<p>To see the rendered mathematical expressions, you’ll need to enable JavaScript.</div></div></noscript><p><img alt="The Polynomial king and he can do anything!" src=https://storopoli.com/blog/shamir-secret-sharing/polynomial_king.webp><p>In this post, we’ll talk about <strong><a href=https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing>Shamir’s Secret Sharing</a> (SSS)</strong>, a cryptographic algorithm that allows us to <strong>split a secret into multiple parts, called shares, in such a way that the secret can only be reconstructed if a certain number of shares are combined</strong>.<p>The idea is to give a visual intuition of how the algorithm works, and describe the mathematical details behind it.<p>The code for all the plots in this post can be found in <a href=https://github.com/storopoli/shamir-secret-sharing><code>storopoli/shamir-secret-sharing</code></a>.<h2 id=polynomial-interpolation>Polynomial Interpolation</h2><p><strong>If you have two points you can draw a <em>unique</em> line that passes through them</strong>. Suppose that you have the points $(3,3)$ and $(4,4)$. Hence, there is only one line that passes through these two points. See the plot below.<p><img alt="A line passing through two points" src=https://storopoli.com/blog/shamir-secret-sharing/line.svg><p><strong>If you have three points you can draw a <em>unique</em> parabola that passes through them</strong>. Suppose that you have the points $(-4,16)$, $(1,1)$, and $(4,16)$. Hence, there is only one parabola that passes through these three points.<p><img alt="A parabola passing through three points" src=https://storopoli.com/blog/shamir-secret-sharing/quadratic.svg><p><strong>If you have four points you can draw a <em>unique</em> cubic polynomial that passes through them</strong>. Suppose that you have the points $(-2,8)$, $(-1,1)$, $(1,1)$, and $(2,8)$. Hence, there is only one cubic polynomial that passes through these four points.<p><img alt="A cubic polynomial passing through four points" src=https://storopoli.com/blog/shamir-secret-sharing/cubic.svg><p>As you might have guessed, <strong>if you have $n$ points you can draw a <em>unique</em> polynomial of degree $n-1$ that passes through them</strong>. This is called <strong>polynomial interpolation</strong>.<blockquote><p><a href="https://storopoli.com/blog/shamir-secret-sharing/$block.attrs('info')"></a> Steams from the <a href=https://en.wikipedia.org/wiki/Lagrange_polynomial>Lagrange interpolation</a>.</blockquote><p>More formally, say that we have a polynomial $f(x)$ of degree $n$:<p>$$ f(x) = ax^n + a_{n-1} x^{n-1} + \ldots + a_1 x + a_0 $$<p>and we have $n$ points $(x_1, y_1)$, $(x_2, y_2)$, $\ldots$, $(x_n, y_n)$. Then, there is a unique polynomial $f(x)$ of degree $n-1$ such that $f(x_i) = y_i$ for $i = 1, 2, \ldots, n$.<h2 id=shamir-s-secret-sharing>Shamir’s Secret Sharing</h2><p>Ok now let’s connect this idea to Shamir’s Secret Sharing. Suppose you encode a <strong>secret $k$ as a number</strong>. Let’s say a private key for a Bitcoin wallet. As you’ve already know, a private key is just a <a href="https://storopoli.com/blog/shamir-secret-sharing/$link.page('blog/2024-02-05-crypto-basics')">very big number</a>.<p>You want to split this secret into <strong>$N$ parts</strong>, called <strong>shares</strong>. You also want to specify a <strong>threshold $T$</strong> such that the <strong>secret $k$ can only be reconstructed if at <em>least</em> $T$ shares are combined</strong>. Here’s how you can use polynomial interpolation to achieve this.<p>The idea is to use polynomial interpolation to generate a polynomial $f(x)$ of degree $T-1$ such that $f(0) = k$. In other words, the polynomial $f(x)$ when evaluated at $x = 0$ should give you the secret $k$. Then, you can <strong>generate $N$ shares by evaluating $f(x)$ at $N$ different points</strong>.<p>Here’s an example with $T = 4$ and $N = 5$. Our secret is $k = 5$ and since $T = 4$, we generate a polynomial of degree $T-1 = 3$. We’ve chosen the polynomial $f(x) = 2x^3 - 3x^2 + 2x + 5 $. Then, we evaluate $f(x)$ at $N = 5$ different points to generate the shares.<p><img alt="Shamir’s Secret Sharing with $N=5$ and $T=4$" src=https://storopoli.com/blog/shamir-secret-sharing/shamir.svg><p>Now this polynomial is <strong>guaranteed to pass through the point $(0, k)$</strong>. Hence if you evaluate <strong>$f(0)$ you get the secret $k$</strong>. To know the secret, you <strong>need to know the polynomial $f(x)$</strong>. And to know the polynomial $f(x)$, you <strong>need to know at least $T$ shares</strong>. Otherwise, you <strong>can’t reconstruct the polynomial and hence the secret</strong>.<p>In this setup we generate addresses from the extended public key (xpub) of a Bitcoin wallet that has the private key $k$. Then, we split the private key into shares and distribute them to different people. Only if at least $T$ people come together, they can reconstruct the private key and spend the funds.<h2 id=rotating-shares>Rotating Shares</h2><p>Note that there’s nothing special about the points<ul><li>$(-2, f(-2))$<li>$(-1, f(-1))$<li>$(\frac{1}{2}, f(\frac{1}{2}))$<li>$(1, f(1))$<li>$(2, f(2))$</ul><p>that we’ve used in the previous example. You could have chosen <strong>any other $N$ points and the polynomial would still be the same</strong>.<p>Suppose now that your share buddy has lost his share. Then, the participants can get together and <strong>generate a new polynomial evaluation at any point $n \notin \{ -2, -1, \frac{1}{2}, 1, 2 \}$</strong>.<p>This is exactly what the image below shows:<p><img alt="Shamir’s Secret Sharing with $N=5$ and $T=4$" src=https://storopoli.com/blog/shamir-secret-sharing/shamir_alternate_single.svg><p>Here we’ve replaced the point $(-2, f(-2))$ with the point $(3, f(3))$. We also assume that the point $(-2, f(-2))$ is lost. The <strong>polynomial is still the same</strong>, and the secret can still be reconstructed if at least $T$ shares are combined.<p>We can also <strong>rotate all the shares</strong>. This is shown in the image below:<p><img alt="Shamir’s Secret Sharing with $N=5$ and $T=4$" src=https://storopoli.com/blog/shamir-secret-sharing/shamir_alternate_multiple.svg><p>Here <strong>all previous points have been replaced by new points</strong>.<h2 id=the-polynomial-king>The Polynomial King</h2><blockquote><p>I am the <a href="https://youtu.be/ashTaoGrR2o?t=642"><del>Lizard</del> Polynomial King, I can do anything!</a><p>Jim Morrison</blockquote><p>In the end <strong>if you somehow know the polynomial $f(x)$, you can do anything</strong>. You can rug-pull all you share buddies and take all the funds.<p>There are several ways that a malicious actor could learn the polynomial. For example, if the shares are generated in a predictable way, an attacker could guess the polynomial. Or, during the reconstruction phase, an attacker could learn the polynomial by observing the shares. Additionally, during a distributed share generation, an attacker could disrupt the process and force the participants to reveal their shares.<blockquote><p><a href="https://storopoli.com/blog/shamir-secret-sharing/$block.attrs('info')"></a> Or force them to reuse nonces. Then, “poof”, private keys are gone.</blockquote><h2 id=conclusion>Conclusion</h2><p>In this post, <strong>we’ve seen how polynomial interpolation can be used to split a secret into multiple shares</strong>. We’ve also seen how the <strong>secret can be reconstructed if a certain number of shares are combined</strong>. This is the basic idea behind <strong>Shamir’s Secret Sharing (SSS)</strong>.<p>Note that the devil is in the details. A lot of the complexities of SSS come from the <strong>details of how the shares are generated and how the secret is reconstructed</strong>. There are <strong>several types of attacks that can be done by a malicious actor</strong>. Especially during the share generation and reconstruction phases.<p>The intent of this blog post is to show how <strong>elegant, simple and powerful the idea behind SSS is</strong>.</section></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=overlay for=toc-toggle></label><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#polynomial-interpolation>Polynomial Interpolation</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#shamir-s-secret-sharing>Shamir’s Secret Sharing</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#rotating-shares>Rotating Shares</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#the-polynomial-king>The Polynomial King</a><li><a href=https://storopoli.com/blog/shamir-secret-sharing/#conclusion>Conclusion</a></ul></div></div></div><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><link href=https://storopoli.com/katex.min.css rel=stylesheet><script defer src=https://storopoli.com/js/katex.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://storopoli.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://storopoli.com/atom.xml> <img alt=feed loading=lazy src=https://storopoli.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:jose@storopoli.com> <img alt=email loading=lazy src=https://storopoli.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://storopoli.com/publickey.txt> <img alt=pgp loading=lazy src=https://storopoli.com/social_icons/key.svg title=pgp> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/storopoli/> <img alt=github loading=lazy src=https://storopoli.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://matrix.to/#/@jose:storopoli.com> <img alt=matrix loading=lazy src=https://storopoli.com/social_icons/matrix.svg title=matrix> </a><li><a class="nav-links no-hover-padding social" href="https://simplex.chat/contact#/?v=2-5&smp=smp%3A%2F%2FUkMFNAXLXeAAe0beCa4w6X_zp18PwxSaSjY17BKUGXQ%3D%40smp12.simplex.im%2FUXrwU_eqdgeHQ6HYehFs0s8VRHOr3k47%23%2F%3Fv%3D1-2%26dh%3DMCowBQYDK2VuAyEApVAYxmE0bpIIiPftNjehy4qOoa14ubyEGzbRX_BlO0w%253D%26srv%3Die42b5weq7zdkghocs3mgxdjeuycheeqqmksntj57rmejagmg4eor5yd.onion" rel=" me"> <img alt=simplex loading=lazy src=https://storopoli.com/social_icons/simplex.svg title=simplex> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://orcid.org/0000-0002-0559-5176> <img alt=orcid loading=lazy src=https://storopoli.com/social_icons/orcid.svg title=orcid> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> • <a href=https://github.com/storopoli/storopoli.com> Site source </a></small></div></section></footer>